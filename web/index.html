<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
      <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/>
      <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css" integrity="sha384-WskhaSGFgHYWDcbwN70/dfYBj47jz9qbsMId/iRN3ewGhXQFZCSftd1LZCfmhktB" crossorigin="anonymous">
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.12.1/bootstrap-table.min.css" integrity="sha256-UP+6xezmmsC027u61a8Ks+Xnp+TftBfw4PcrNyPXC40=" crossorigin="anonymous" />
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.12.1/extensions/filter-control/bootstrap-table-filter-control.css" integrity="sha256-scTkOuxpT3mjWR36xEaWlCEKBjieTRteuOk3tICdM7M=" crossorigin="anonymous" />
      <link rel="stylesheet" href="/css/dashboard.css">
      <script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
      <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js" integrity="sha384-smHYKdLADwkXOn1EmN1qk/HfnUcbVRZyYmZ4qpPea6sjB/pTJ0euyQp0Mk8ck+5T" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.12.1/bootstrap-table.min.js" integrity="sha256-l+jZldmOASkIPelan4NKyAFD+oGNqPulrVQwsjxuCXc=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.12.1/extensions/auto-refresh/bootstrap-table-auto-refresh.min.js" integrity="sha256-wM+7Q0ikz4eLE3kaE/Q4Dgb495iz2UzN3leHPLCdXCY=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.12.1/extensions/filter-control/bootstrap-table-filter-control.min.js" integrity="sha256-JpqYkcCJyvE+kxrFvhclJVe8LXkDIrqlio0V90A/yuM=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.12.1/extensions/export/bootstrap-table-export.min.js" integrity="sha256-dgKPXFPCSahQeFL/1cdwPPeEOBLAZR8hUdYIPLb/Jyw=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/handlebars.js/4.0.11/handlebars.min.js" integrity="sha256-+JMHsXRyeTsws/tzbIh5YHQxRdKCuNjmvNcTFtY6DLc=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.1/Chart.min.js"></script>
      <script src="https://unpkg.com/feather-icons/dist/feather.min.js"></script>
      <script src="/js/includes.js"></script>
      <script src="/js/utilities.js"></script>
      <title>MultiPoolMiner Local Dashboard</title>
    </head>
    <body data-navbaractive="navdashboard">
    <div id="includeheader"></div>

    <div class="container-fluid">
      <div class="row">
      <div id="includenavbar"></div>
        <main role="main" class="col-md-9 ml-sm-auto col-lg-10 px-4">
          <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
            <h1 class="h2">Dashboard</h1>
          </div>

          <h2>Balances</h2>
          <div id="balanceboxes" class="row"></div>
        </main>
      </div>
    </div>

    <!-- End of page scripts -->
    <script id="poolbalance_template" type="text/x-handlebars-template">
      <div class="col-sm-2">
        <div class="card">
          <div class="card-body text-center">
            <h5 class="card-title">{{name}}</h5>
            <p class="card-text currencies">
            {{#each balances}}
              <span class="currencyname">{{@key}}:</span> <span>{{this}}</span>
            {{/each}}
            </p>
          </div>
        </div>
      </div>
    </script>

    <script type="text/javascript">
    $(function() {
        function updatePoolBalances() {
            $.ajax({url: '/balances', success: function(result) {
                console.log(result);
                $("#balanceboxes").empty();
                var template = Handlebars.compile($("#poolbalance_template").html());
                $.each(result, function(index, item) {
                    if (item.Name == "*Total*") { return true; }
                    var properties = Object.keys(item);
                    var currencies = properties.filter((properties) => properties.startsWith("Total_"));
                    var data = {name: item.Name, balances: {}};
                    $.each(currencies, function(cindex, currency) {
                        var name = currency.replace("Total_","");
                        data["balances"][name] = item[currency];
                    });
                    $("#balanceboxes").append(template(data));
                });
            }});
        }
        updatePoolBalances();
        window.setInterval(function() { updatePoolBalances();}, 60000);
    });
    </script>



  </body>
</html>